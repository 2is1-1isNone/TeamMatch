<!-- This is a backup of the team calendar template before the latest changes. team_calendar.html -->

{% extends "users/base.html" %}
{% block title %}{{ team.name }} Calendar{% endblock %}
{% block content %}

<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>

<div class="mb-4 d-flex align-items-center">
    <span id="homeLabel" class="fw-bold me-2" style="color:#0d6efd; cursor:pointer;">Home</span>
    <div class="form-check form-switch">
        <input class="form-check-input" type="checkbox" id="homeAwayToggle">
    </div>
    <span id="awayLabel" class="fw-bold ms-2" style="color:#ffb366; cursor:pointer;">Away</span>
</div>
<div id="calendar"></div>

<script>
let mode = 'home';
let events = [];

document.addEventListener('DOMContentLoaded', function() {
    const calendarEl = document.getElementById('calendar');
    const calendar = new FullCalendar.Calendar(calendarEl, {
        headerToolbar: {
            left: 'prev,next',
            center: 'title',
            right: ''
        },
        initialView: 'multiMonth',
        views: {
            multiMonth: {
                duration: { months: 8 },     // Show 8 months total
                multiMonthMaxColumns: 2,     // 2 columns
                multiMonthRows: 4            // 4 rows
            }
        },
        dayMaxEvents: 0,
        showNonCurrentDates: true,
        fixedWeekCount: false,
        height: 'auto',
        selectable: true,
        eventDisplay: 'none',
        selectMirror: true,
        dateClick: function(info) {  // Changed from select to dateClick
            const existingEventIndex = events.findIndex(ev => ev.start === info.dateStr);
            
            if (existingEventIndex !== -1) {
                // Remove existing event
                events.splice(existingEventIndex, 1);
                info.dayEl.style.backgroundColor = '';
                info.dayEl.style.color = '';
            } else {
                // Add new event
                events.push({
                    title: mode === 'home' ? 'Home Game' : 'Away Game',
                    start: info.dateStr,
                    allDay: true,
                    color: mode === 'home' ? '#0d6efd' : '#ffb366'
                });
                info.dayEl.style.backgroundColor = mode === 'home' ? '#0d6efd' : '#ffb366';
                info.dayEl.style.color = '#fff';
            }
        },
        dayCellDidMount: function(arg) {
            // Apply colors to any existing events
            const event = events.find(ev => ev.start === arg.dateStr);
            if (event) {
                arg.el.style.backgroundColor = event.color;
                arg.el.style.color = '#fff';
            }
        },
        datesSet: function() {
            // Reapply colors when view changes
            events.forEach(event => {
                const cell = document.querySelector(`.fc-daygrid-day[data-date="${event.start}"]`);
                if (cell) {
                    cell.style.backgroundColor = event.color;
                    cell.style.color = '#fff';
                }
            });
        }
    });
    
    const toggle = document.getElementById('homeAwayToggle');
    const homeLabel = document.getElementById('homeLabel');
    const awayLabel = document.getElementById('awayLabel');

    toggle.addEventListener('change', function() {
        if (this.checked) {
            mode = 'away';
            homeLabel.style.opacity = 0.5;
            awayLabel.style.opacity = 1;
        } else {
            mode = 'home';
            homeLabel.style.opacity = 1;
            awayLabel.style.opacity = 0.5;
        }
    });

    // Make labels clickable
    homeLabel.addEventListener('click', function() {
        toggle.checked = false;
        toggle.dispatchEvent(new Event('change'));
    });
    awayLabel.addEventListener('click', function() {
        toggle.checked = true;
        toggle.dispatchEvent(new Event('change'));
    });

    // Set initial state
    homeLabel.style.opacity = 1;
    awayLabel.style.opacity = 0.5;

    calendar.render();
});
</script>

<p class="mt-3 text-muted">
    Click "Home" or "Away" then click a date to add games. Click a colored cell to remove it.
</p>
{% if user in team.admins.all %}
    <a href="{% url 'edit_team' team.id %}" class="btn btn-warning mb-3">Edit Team</a>
{% endif %}

{% endblock %}