{% extends "users/base.html" %}
{% block title %}League Calendar{% endblock %}
{% block content %}
<h2>{{ association.name }} League Calendar - {{age_group}} {{tier}} ({{season}})</h2>
<div class="mb-3">
    <span style="color: #87CEFA; font-weight: bold;">Home</span>
    <span style="margin: 0 1em;"></span>
    <span style="color: #ffb366; font-weight: bold;">Away</span>
</div>
<div id="leagueCalendar"></div>

<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>

<style>
/* Make all event backgrounds white and remove border */
.fc-event-main, .fc-event {
    background: #fff !important;
    border: none !important;
    color: inherit;
}
</style>

<script id="league-events-json" type="application/json">{{ events_json|safe }}</script>

<script>
function parseEvents() {
    const raw = document.getElementById('league-events-json');
    if (!raw) return [];
    try { return JSON.parse(raw.textContent); } catch { return []; }
}
document.addEventListener('DOMContentLoaded', function() {
    const calendarEl = document.getElementById('leagueCalendar');
    const events = parseEvents();
    const calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        height: 'auto',
        showNonCurrentDates: false,
        fixedWeekCount: false,
        headerToolbar: {
            left: 'prev',
            center: 'title',
            right: 'next'
        },
        eventContent: function(arg) {
            if (arg.event.extendedProps.home && arg.event.extendedProps.away) {
                return { html: `<span style='color:#87CEFA;'>${arg.event.extendedProps.home}</span><br><span style='color:#ffb366;'>${arg.event.extendedProps.away}</span>` };
            }
            return { html: arg.event.title };
        },
        events: events
    });
    calendar.render();
});
</script>
{% endblock %}
